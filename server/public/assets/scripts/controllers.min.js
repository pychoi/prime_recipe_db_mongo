/*! recipe_db_app 2015-12-03 */
myApp.controller("EnterController",["$scope","$http","DataService",function(a,b,c){a.dataService=c,a.recipe={},a.recipe.ingredients=[],a.recipe.instructions=[{step:1}],a.recipe.categories=[],a.ingredient={},a.disable=!1,a.checkIngredient=!0,a.newRecipe={},a.searchMode=!0,a.main=a.dataService.mainArray(),a.cuisine=a.dataService.cuisineArray(),a.type=a.dataService.dishTypeArray(),a.addIngredient=function(){a.recipe.ingredients.push(a.ingredient),a.checkIngredient=!1,a.ingredient={},a.enterIngredients.$setUntouched()},a.deleteIngredient=function(b){for(var c=0;c<a.recipe.ingredients.length;c++)b.name==a.recipe.ingredients[c].name&&b.amount==a.recipe.ingredients[c].amount&&a.recipe.ingredients.splice(c,1);a.recipe.ingredients.length<1&&(a.checkIngredient=!0)},a.addNewStep=function(){var b=a.recipe.instructions.length+1;a.recipe.instructions.push({step:b})},a.removeStep=function(b){for(var c=0;c<a.recipe.instructions.length;c++)b.step==a.recipe.instructions[c].step&&a.recipe.instructions.splice(c,1);for(var c=0;c<a.recipe.instructions.length;c++)a.recipe.instructions[c].step=c+1},a.toggleChecked=function(b){-1===a.recipe.categories.indexOf(b)?a.recipe.categories.push(b):a.recipe.categories.splice(a.recipe.categories.indexOf(b),1)},a.submitRecipe=function(){b.post("/submit/",a.recipe).then(function(b){a.newRecipe=b.data,a.successMessage="Recipe is entered!",a.searchMode=!1})}}]),myApp.controller("HomeController",["$scope","$http","DataService",function(a,b,c){a.randomResult={},a.modalShown=!1,a.showRandom=!1,a.dataService=c,a.randomRecipe=function(){a.checkMealPlan=!1,a.saveSuccessMessage=!1,b.get("/random/").then(function(c){a.randomResult=c.data,b.get("/user/mealPlan").then(function(b){a.savedRecipes=b.data.mealSaved;for(var c=0;c<a.savedRecipes.length;c++)a.savedRecipes[c]._id==a.randomResult._id&&(a.checkMealPlan=!0,a.saveSuccessMessage=!0)})})},a.randomRecipeClick=function(){a.showRandom=!0,a.randomRecipe()},a.toggleModal=function(){a.modalShown=!a.modalShown},a.addToMealPlan=function(c){b.put("/user/mealPlan",c).then(function(){a.checkMealPlan=!0,a.saveSuccessMessage=!0})}}]),myApp.controller("ListController",["$scope","$http",function(a,b){a.noSavedRecipesMessage=!1,a.saveSuccessMessage=!1,a.savedList=[],a.getList=function(){b.get("/user/groceriesList").then(function(b){a.savedList=b.data.groceriesList,a.savedList.length<1&&(a.noSavedRecipesMessage=!0)})},a.removeFromList=function(c){b.put("/user/groceriesList/remove",c).then(function(){console.log("removed from list"),a.getList()})},a.resetList=function(){b["delete"]("/user/groceriesList").then(function(){a.getList()})},a.toggleModal=function(c){a.modalShown=!a.modalShown,a.currentIndex=a.savedList.indexOf(c),b.get("/user/mealPlan").then(function(b){a.savedRecipes=b.data.mealSaved;for(var d=0;d<a.savedRecipes.length;d++)a.savedRecipes[d]._id==c._id&&(a.checkMealPlan=!0,a.saveSuccessMessage=!0)})},a.getList(),a.saveStatus=function(){b["delete"]("/user/groceriesList").then(function(){for(var c=0;c<a.savedList.length;c++)b.put("/user/groceriesList",a.savedList[c]).then(function(){a.getList()})})}}]),myApp.controller("MealController",["$scope","$http",function(a,b){a.savedRecipes=[],a.savedList=[],a.noSavedRecipesMessage=!1,a.modalShown=!1,a.currentIndex,a.disableListButton={},a.getSavedRecipes=function(){b.get("/user/mealPlan").then(function(b){a.savedRecipes=b.data.mealSaved,a.savedRecipes.length<1&&(a.noSavedRecipesMessage=!0)}),b.get("/user/groceriesList").then(function(b){a.savedList=b.data.groceriesList;for(var c=0;c<a.savedRecipes.length;c++)for(var d=0;d<a.savedList.length;d++)a.savedRecipes[c]._id==a.savedList[d]._id&&(a.disableListButton[a.savedList[d].name]=!0)})},a.removeFromMealPlan=function(c){b.put("/user/mealPlan/remove",c).then(function(){a.getSavedRecipes()})},a.toggleModal=function(c){a.modalShown=!a.modalShown,a.currentIndex=a.savedRecipes.indexOf(c),b.get("/user/mealPlan").then(function(b){a.savedRecipes=b.data.mealSaved;for(var d=0;d<a.savedRecipes.length;d++)a.savedRecipes[d]._id==c._id&&(a.checkMealPlan=!0,a.saveSuccessMessage=!0)})},a.addToList=function(c){b.put("/user/groceriesList",c).then(function(){a.disableListButton[c.name]=!0})},a.getSavedRecipes()}]),myApp.controller("ResultController",["$scope","$location","$http","$routeParams",function(a,b,c,d){a.resultArray=[],a.query=d.query,a.url=b.absUrl(),a.modalShown=!1,a.currentIndex,a.saveSuccessMessage=!1,a.checkMealPlan=!1,a.savedRecipes=[],a.checkType=typeof a.query,"object"==a.checkType?c.get("/search/categories",{params:a.query}).then(function(b){a.resultArray=b.data,a.numberOfResults=a.resultArray.length}):c.get("/search/keyword",{params:{keyword:a.query}}).then(function(b){a.resultArray=b.data,a.numberOfResults=a.resultArray.length}),a.toggleModal=function(b){a.modalShown=!a.modalShown,a.currentIndex=a.resultArray.indexOf(b),c.get("/user/mealPlan").then(function(c){a.savedRecipes=c.data.mealSaved;for(var d=0;d<a.savedRecipes.length;d++)a.savedRecipes[d]._id==b._id&&(a.checkMealPlan=!0,a.saveSuccessMessage=!0)})},a.addToMealPlan=function(b){c.put("/user/mealPlan",b).then(function(){a.checkMealPlan=!0,a.saveSuccessMessage=!0})}}]),myApp.controller("SearchController",["$scope","$http","DataService","$location",function(a,b,c,d){a.dataService=c,a.search={},a.search.categories=[],a.search.keyword="",a.searchMode=!0,a.resultArray=[],a.main=a.dataService.mainArray(),a.cuisine=a.dataService.cuisineArray(),a.type=a.dataService.dishTypeArray(),a.toggleChecked=function(b){-1===a.search.categories.indexOf(b)?a.search.categories.push(b):a.search.categories.splice(a.search.categories.indexOf(b),1)},a.searchKeyword=function(a){d.path("/result").search({query:a})},a.searchCategories=function(){d.path("/result").search({query:{categories:a.search.categories}})}}]);